<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Master Cloud Editor</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #000; color: white; margin: 0; padding: 10px; display: flex; flex-direction: column; align-items: center; min-height: 100vh; }
        #lock-screen { position: fixed; inset: 0; background: #000; z-index: 10000; display: flex; align-items: center; justify-content: center; }
        .lock-box { background: #111; padding: 30px; border-radius: 20px; border: 1px solid #333; text-align: center; width: 280px; }
        #main-content { display: none; width: 100%; max-width: 900px; }
        .matrix { display: grid; grid-template-columns: 1fr; gap: 10px; margin-top: 15px; }
        @media (min-width: 768px) { .matrix { grid-template-columns: 1fr 1fr; } }
        .quadrant { padding: 15px; border-radius: 15px; background: #111; border-top: 4px solid; min-height: 200px; }
        .q1 { border-color: #ff4d4d; } .q2 { border-color: #007bff; }
        .q3 { border-color: #ffc107; } .q4 { border-color: #28a745; }
        input, textarea { width: 100%; padding: 12px; border-radius: 10px; border: 1px solid #333; background: #222; color: #fff; box-sizing: border-box; outline: none; }
        button { cursor: pointer; border: none; border-radius: 10px; padding: 12px; font-weight: bold; transition: 0.3s; }
        .item { background: #1a1a1a; padding: 12px; border-radius: 10px; margin-bottom: 8px; border: 1px solid #333; }
        .file-action { color: #007bff; cursor: pointer; font-weight: bold; font-size: 13px; margin-right: 10px; text-decoration: underline; }
        
        /* –û–ö–ù–û –†–ï–î–ê–ö–¢–û–†–ê */
        #editor-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 9999; padding: 20px; flex-direction: column; }
        #editor-area { flex-grow: 1; font-family: monospace; font-size: 14px; margin: 15px 0; background: #000; color: #0f0; border: 1px solid #444; }
    </style>
</head>
<body>

    <div id="lock-screen">
        <div class="lock-box">
            <h2>Master Cloud</h2>
            <input type="password" id="pass-input" placeholder="–ü–∞—Ä–æ–ª—å" style="text-align:center; margin-bottom:15px">
            <button onclick="checkPass()" style="width:100%; background:#fff; color:#000">–í–û–ô–¢–ò</button>
        </div>
    </div>

    <div id="editor-overlay">
        <h3 id="edit-title">–†–µ–¥–∞–∫—Ç–æ—Ä</h3>
        <textarea id="editor-area"></textarea>
        <div style="display:flex; gap:10px">
            <button onclick="saveEdit()" style="background:#28a745; color:#fff; flex:1">–°–û–•–†–ê–ù–ò–¢–¨</button>
            <button onclick="closeEditor()" style="background:#444; color:#fff; flex:1">–ó–ê–ö–†–´–¢–¨</button>
        </div>
    </div>

    <div id="main-content">
        <div style="display:flex; justify-content:space-between; align-items:center">
            <h3>Matrix Cloud Editor ‚òÅÔ∏è</h3>
            <button onclick="logout()" style="background:#ff4d4d; color:white; padding:5px 15px">–í–´–•–û–î</button>
        </div>

        <div class="matrix">
            <div class="quadrant q1"><h4 style="color:#ff4d4d; margin:0">üî• –°–†–û–ß–ù–û</h4><div class="ui" id="ui1"></div><div id="list1"></div></div>
            <div class="quadrant q2"><h4 style="color:#007bff; margin:0">üìÖ –í–ê–ñ–ù–û</h4><div class="ui" id="ui2"></div><div id="list2"></div></div>
            <div class="quadrant q3"><h4 style="color:#ffc107; margin:0">‚ö° –î–ï–õ–ï–ì–ò–†–û–í–ê–¢–¨</h4><div class="ui" id="ui3"></div><div id="list3"></div></div>
            <div class="quadrant q4"><h4 style="color:#28a745; margin:0">üå± –ó–ê–ú–ï–¢–ö–ò</h4><div class="ui" id="ui4"></div><div id="list4"></div></div>
        </div>
    </div>

<script>
    const SECRET = "15081994";
    let currentEditKey = null;

    function checkPass() {
        if(document.getElementById('pass-input').value === SECRET) {
            localStorage.setItem('master_auth', 'true');
            location.reload();
        }
    }
    function logout() { localStorage.removeItem('master_auth'); location.reload(); }

    if(localStorage.getItem('master_auth') === 'true') {
        document.getElementById('lock-screen').style.display = 'none';
        document.getElementById('main-content').style.display = 'block';
        
        const firebaseConfig = {
            apiKey: "AIzaSyAm7l3kLNaXW90TyN9gFS2pwfdseimErdc",
            databaseURL: "https://fail-21187-default-rtdb.firebaseio.com",
            projectId: "fail-21187",
            appId: "1:621043286513:web:dc826eaa4ddebb5cc14450"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        [1,2,3,4].forEach(n => {
            document.getElementById('ui'+n).innerHTML = `
                <div style="display:flex; gap:5px; margin:10px 0">
                    <input type="text" id="in${n}" placeholder="+ —Ç–µ–∫—Å—Ç">
                    <button onclick="document.getElementById('f${n}').click()">üìé</button>
                    <input type="file" id="f${n}" style="display:none" onchange="upload(${n})">
                    <button onclick="addText(${n})" style="background:#fff; color:#000">+</button>
                </div>`;
        });

        db.ref('matrix_v2').on('value', snap => {
            [1,2,3,4].forEach(n => document.getElementById('list'+n).innerHTML = '');
            snap.forEach(child => {
                const val = child.val();
                const div = document.createElement('div');
                div.className = 'item';
                div.innerHTML = `
                    <div style="margin-bottom:8px"><b>${val.f ? 'üìÑ' : 'üìå'} ${val.t}</b></div>
                    <div style="display:flex; justify-content:space-between">
                        <div>
                            ${val.f ? `<span class="file-action" onclick="openEditor('${child.key}')">–†–ï–î–ê–ö–¢–ò–†–û–í–ê–¢–¨</span>` : ''}
                            ${val.f ? `<a href="${val.f}" download="${val.t}" class="file-action">–°–ö–ê–ß–ê–¢–¨</a>` : ''}
                        </div>
                        <span style="color:red; cursor:pointer" onclick="del('${child.key}')">–£–î–ê–õ–ò–¢–¨</span>
                    </div>`;
                document.getElementById('list'+val.q).prepend(div);
            });
        });

        window.addText = (q) => {
            const t = document.getElementById('in'+q).value;
            if(t) db.ref('matrix_v2').push({q, t});
            document.getElementById('in'+q).value = '';
        };

        window.upload = (q) => {
            const file = document.getElementById('f'+q).files[0];
            const reader = new FileReader();
            reader.onload = (e) => db.ref('matrix_v2').push({q, t: file.name, f: e.target.result, isText: true});
            reader.readAsDataURL(file);
        };

        window.del = (k) => { if(confirm('–£–¥–∞–ª–∏—Ç—å?')) db.ref('matrix_v2/'+k).remove(); };

        window.openEditor = (k) => {
            currentEditKey = k;
            db.ref('matrix_v2/'+k).once('value', s => {
                const data = s.val().f;
                // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º Base64 –æ–±—Ä–∞—Ç–Ω–æ –≤ —Ç–µ–∫—Å—Ç
                try {
                    const content = decodeURIComponent(escape(atob(data.split(',')[1])));
                    document.getElementById('editor-area').value = content;
                    document.getElementById('edit-title').innerText = "–ü—Ä–∞–≤–∫–∞: " + s.val().t;
                    document.getElementById('editor-overlay').style.display = 'flex';
                } catch(e) {
                    alert("–≠—Ç–æ—Ç —Ñ–æ—Ä–º–∞—Ç –Ω–µ–ª—å–∑—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞–∫ —Ç–µ–∫—Å—Ç (—Ç–æ–ª—å–∫–æ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ)");
                }
            });
        };

        window.saveEdit = () => {
            const newContent = document.getElementById('editor-area').value;
            const base64 = "data:text/plain;base64," + btoa(unescape(encodeURIComponent(newContent)));
            db.ref('matrix_v2/'+currentEditKey).update({f: base64});
            closeEditor();
        };

        window.closeEditor = () => { document.getElementById('editor-overlay').style.display = 'none'; };
    }
</script>
</body>
</html>
